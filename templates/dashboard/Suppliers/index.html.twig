{% extends 'layout.html.twig' %}
{% block title %}{% trans %}Suppliers manager{% endtrans %}{% endblock %}

{# CSS estándar para paneles de filtros #}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/filter-panels-standard.css') }}">
{% endblock %}

{% block body %}
	{{ parent() }}
    {{ include('sgvDashboardBundle:Suppliers:messages/success.html.twig') }}
	<div id="main-wrapper" class="container">
		<div class="col-md-12">
			<div class="page-header margin-none">
				<h1 class="padding-none">{% trans %}Suppliers manager{% endtrans %}</h1>
			</div>
            <div class="btn-group mb-3">
                <button class="btn btn-info waves-effect waves-light" type="button">
                    {% trans %}Total records: {% endtrans %}
                    <span id="total" class="badge bg-light text-dark"> {{ pagination.getTotalItemCount }} </span>
                </button>
                <a href="{{ path('sgv_suppliers_add' )}}" class="btn btn-primary waves-effect waves-light">
                    <i class="fas fa-plus-circle" aria-hidden="true"></i> {{ 'New Supplier'|trans }}
                </a>
            </div>

			{# Panel de filtros estandarizado usando el template base #}
            {% embed 'components/filter_panel_base.html.twig' with {
                panel_id: 'suppliers-filter-panel',
                panel_title: 'Filtros Avanzados',
                collapsed: true,
                form_method: 'get',
                form_action: '',
                submit_button_text: 'Mostrar resultados',
                reset_button_text: 'Limpiar filtros'
            } %}
                {% block filter_fields %}
                    <div class="filter-fields-grid">
                        {# Filas por página #}
                        <div class="mb-3">
                            <label for="rowsPerPage" class="form-label">Filas por página</label>
                            <select class="form-select selectpicker" id="rowsPerPage" name="rowsPerPage">
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                                <option value="20">20</option>
                                <option selected="selected" value="25">25</option>
                                <option value="30">30</option>
                                <option value="40">40</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="200">200</option>
                                <option value="300">300</option>
                                <option value="400">400</option>
                                <option value="500">500</option>
                                <option value="1000">1000</option>
                            </select>
                        </div>

                        {# Estado de registros #}
                        <div class="mb-3">
                            <label for="regStatus" class="form-label">Est. Registros</label>
                            <select class="form-select selectpicker" id="regStatus" name="regStatus">
                                <option value="all">Todos</option>
                                <option value="true" selected="selected">Activos</option>
                                <option value="false">Eliminados</option>
                            </select>
                        </div>

                        {# Filtro de Proveedor #}
                        <div class="mb-3">
                            <label class="form-label" for="filterSupplier">Filtro de Proveedor</label>
                            <input type="text" class="form-control" id="filterSupplier" name="filterSupplier" placeholder="Nombre a buscar">
                        </div>

                        {# Filtro de RUT #}
                        <div class="mb-3">
                            <label class="form-label" for="filterRUT">Filtro de RUT</label>
                            <input type="text" class="form-control" id="filterRUT" name="filterRUT" placeholder="RUT a buscar">
                        </div>

                        {# Filtro de Dirección #}
                        <div class="mb-3">
                            <label class="form-label" for="filterAddress">Filtro de Dirección</label>
                            <input type="text" class="form-control" id="filterAddress" name="filterAddress" placeholder="Dirección a buscar">
                        </div>

                        {# Filtro de Contacto #}
                        <div class="mb-3">
                            <label class="form-label" for="filterContactName">Filtro de Contacto</label>
                            <input type="text" class="form-control" id="filterContactName" name="filterContactName" placeholder="Nombre del contacto">
                        </div>
                    </div>
                {% endblock %}
            {% endembed %}

			{# Tabla de proveedores #}
			<div class="table-responsive">
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th>{{ knp_pagination_sortable(pagination, 'Id'|trans, 'reg.idProveedor') }}</th>
							<th>{{ knp_pagination_sortable(pagination, 'Supplier'|trans, 'reg.razonSocial') }}</th>
							<th>{{ knp_pagination_sortable(pagination, 'RUT'|trans, 'reg.rutProveedor') }}</th>
							<th>{{ knp_pagination_sortable(pagination, 'Address'|trans, 'reg.direccionProveedor') }}</th>
							<th>{{ knp_pagination_sortable(pagination, 'Contact Name'|trans, 'reg.nombreContacto') }}</th>
							<th>{{ knp_pagination_sortable(pagination, 'Email'|trans, 'reg.correoElecContacto') }}</th>
							<th class="actions">{{ 'Actions'|trans }}</th>
						</tr>
					</thead>
					<tbody>
				        {% for suppliers in pagination %}
				            <tr data-id="{{ suppliers.idProveedor }}" data-restoreurl="{{ path('sgv_suppliers_update',{id: suppliers.idProveedor }) }}">
				                <td style="width: 50px;">{{ suppliers.idProveedor }}</td>
				                <td style="width: 150px;">{{ suppliers.razonSocial }}</td>
								<td style="width: 150px;">{{ suppliers.rutProveedor }}</td>
								<td style="width: 200px;">{{ suppliers.direccionProveedor }}</td>
								<td style="width: 150px;">{{ suppliers.nombreContacto }}</td>
								<td style="width: 340px;">{{ suppliers.correoElecContacto }}</td>
								<td class="actions" style="width: 150px;">
									<a href="{{ path('sgv_suppliers_edit', { id: suppliers.idProveedor }) }}" class="btn btn-sm btn-primary waves-effect waves-light">
										{{ 'Edit'|trans }}
									</a>
									{% if suppliers.regStatus %}
										<a href="#" id="btn-delete-id-{{ suppliers.idProveedor }}" class="btn btn-sm btn-danger waves-effect waves-light btn-delete">
											{{ 'Delete'|trans }}
										</a>
									{% else %}
										<a href="#" id="btn-restore-id-{{ suppliers.idProveedor }}" class="btn btn-sm btn-info waves-effect waves-light btn-restore">
											Restaurar
										</a>
									{% endif %}
								</td>
				            </tr>
				        {% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>

    {{ include('sgvDashboardBundle:Suppliers:forms/form.html.twig', { form: delete_form_ajax, message: 'Are you sure ?'|trans, id: 'form-delete', with_submit: false}) }}

{% endblock %}

	{% block paginator %}
		{# display navigation #}
		<div class="navigation">
			{{ knp_pagination_render(pagination) }}
		</div>
	{% endblock %}

{% block javascripts  %}
	{{ parent() }}

    {# Componentes estándar de filtros #}
    <script src="{{ asset('js/components/FilterPanel.js') }}"></script>
    <script src="{{ asset('js/components/NotificationManager.js') }}"></script>
    <script src="{{ asset('js/utils/ajax-helpers.js') }}"></script>

	<script src="{{ asset('bundles/sgvdashboard/js/delete.js') }}"></script>
	<script>
		jQuery(document).ready(function()
		{
			// Restaurar valores de filtros desde servidor
			{% if rowsPerPage %}
			$('#rowsPerPage').val('{{ rowsPerPage }}').trigger('change');
			$('#rowsPerPage').selectpicker('refresh');
			{% endif %}

			{% if regStatus %}
			$('#regStatus').val('{{ regStatus }}').trigger('change');
			$('#regStatus').selectpicker('refresh');
			{% endif %}

			{% if filterSupplier %}
			$('#filterSupplier').val('{{ filterSupplier }}');
			{% endif %}

			{% if filterRUT %}
			$('#filterRUT').val('{{ filterRUT }}');
			{% endif %}

			{% if filterAddress %}
			$('#filterAddress').val('{{ filterAddress }}');
			{% endif %}

			{% if filterContactName %}
			$('#filterContactName').val('{{ filterContactName }}');
			{% endif %}

            // Inicializar selectpickers (Bootstrap Select compatible con Bootstrap 5)
            $('.selectpicker').selectpicker('refresh');
		});
	</script>
{% endblock %}
